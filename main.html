<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<link rel="stylesheet" href="./css/bootstrap.min.css">
		<link rel="stylesheet" href="./css/layui/css/layui.css">
		<link rel="stylesheet" href="./css/admin.css">
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="css/layui/layui.js"></script>
    </head>
    <style>
		.layui-nav-child.show{
			display: none !important;
		}
    </style>
    <body>
	<div>
		<div class="layui-layout layui-layout-admin">
			<!-- 侧边菜单 -->
			<div class="layui-side layui-side-menu">
				<div class="layui-side-scroll">
					<div class="layui-logo" lay-href="home/console.html">
						<span>系统</span>
					</div>

					<ul class="layui-nav layui-nav-tree" lay-shrink="all"  lay-filter="menu">
						<li data-name="home" class="layui-nav-item">
							<a href="javascript:;" lay-direction="2">
								<i class="layui-icon layui-icon-layouts"></i>
								<cite>菜单一</cite>
								<span class="layui-nav-more"></span>
							</a>
								<dl class="layui-nav-child">
									<dd>
										<a href="javascript:;">
											11
											<span class="layui-nav-more"></span>
										</a>
											<dl class="layui-nav-child">
												<dd>
													<a lay-href="1">11</a>
												</dd>
											</dl>
									</dd>
									<dd>
										<a href="javascript:;">
											12
											<span class="layui-nav-more"></span>
										</a>
										<dl class="layui-nav-child">
											<dd>
												<a lay-href="2">12</a>
											</dd>
										</dl>
									</dd>
								</dl>
						</li>
						<li data-name="home" class="layui-nav-item">
							<a href="javascript:;" lay-direction="2">
								<i class="layui-icon layui-icon-layouts"></i>
								<cite>菜单二</cite>
								<span class="layui-nav-more"></span>
							</a>
							<dl class="layui-nav-child">
								<dd>
									<a href="javascript:;">
										21
										<span class="layui-nav-more"></span>
									</a>
									<dl class="layui-nav-child">
										<dd>
											<a lay-href="3">21</a>
										</dd>
									</dl>
								</dd>
								<dd>
									<a href="javascript:;">
										22
										<span class="layui-nav-more"></span>
									</a>
									<dl class="layui-nav-child">
										<dd>
											<a lay-href="4">22</a>
										</dd>
									</dl>
								</dd>
							</dl>
						</li>
					</ul>
				</div>
			</div>

			<ul class="layui-nav layui-layout-left nav-first-last">
				<li class="layui-nav-item layadmin-flexible" lay-unselect="">
					<a href="javascript:;" layadmin-event="flexible" title="侧边伸缩" id="flexible">
						<i class="layui-icon layui-icon-shrink-right"></i>
					</a>
				</li>
			</ul>
			<!-- 页面标签 -->
			<div class="layadmin-pagetabs" id="tabs">
				<div class="layui-icon layadmin-tabs-control layui-icon-prev" layadmin-event="leftPage"></div>
				<div class="layui-icon layadmin-tabs-control layui-icon-next" layadmin-event="rightPage"></div>
				<div class="layui-icon layadmin-tabs-control layui-icon-down">
					<ul class="layui-nav layadmin-tabs-select" lay-filter="layadmin-pagetabs-nav">
						<li class="layui-nav-item" lay-unselect="">
							<a href="javascript:;"><span class="layui-nav-more"></span></a>
							<dl class="layui-nav-child layui-anim-fadein layui-anim layui-anim-upbit">
								<dd layadmin-event="closeThisTabs"><a href="javascript:;">关闭当前标签页</a></dd>
								<dd layadmin-event="closeOtherTabs" class=""><a href="javascript:;">关闭其它标签页</a></dd>
								<dd layadmin-event="closeAllTabs" class=""><a href="javascript:;">关闭全部标签页</a></dd>
							</dl>
						</li>
						<span class="layui-nav-bar" style="left: 20px; top: 35px; width: 0px; opacity: 0;"></span>
					</ul>
				</div>
				<div class="layui-tab" lay-unauto="" lay-allowclose="true" lay-filter="tabs">
					<ul class="layui-tab-title" id="tabsLi">
						<li lay-id="home/console.html" lay-attr="home/console.html" class="layui-this" id='firstTab'><i class="layui-icon layui-icon-home"></i><i class="layui-icon layui-unselect layui-tab-close">ဆ</i></li>
					</ul>
				</div>
			</div>

			<ul class="layui-nav layui-layout-right nav-first-last">
				<li class="layui-nav-item" style='line-height: 40px;'><a href="">退出</a></li>
			</ul>



			<!-- 主体内容 -->
			<div class="layui-body" id="iframe_div">
				<div class="layui-card layadmin-header" style='display:none'>
					<div class="layui-breadcrumb" lay-filter="breadcrumb" style="visibility: visible;">
						<a lay-href=""></a><span lay-separator="">/</span>
						<a></a><span lay-separator="">/</span>
						<a><cite></cite></a>
					</div>
				</div>
				<div class="layadmin-tabsbody-item layui-show" style='top: 0;z-index:100;background-color: #fff'>
					<iframe src="home.html" frameborder="0" class="layadmin-iframe" data-id="home.jsp"></iframe>
				</div>
			</div>

			<!-- 辅助元素，一般用于移动设备下遮罩 -->
			<div class="layadmin-body-shade" layadmin-event="shade"></div>
		</div>
	</div>
	</body>
    	
<script>

    $(function () {
        var show = true
        var slide_div = $('.layui-layout-admin .layui-side')
        var slide_content = $('.layadmin-pagetabs, .layui-body, .layui-layout-admin .layui-layout-left')
        //保存面包屑内容
        var breadArr = [{}]
        var breadIndex
        layui.use('element', function(){
            var element = layui.element;
            /*点击nav*/
            element.on('nav(menu)', function(elem){

                if(elem.parents('dd').length && elem.attr('href')!='javascript:;'){
                    var url = elem.attr('lay-href')
                    var title = elem.text()

                    var ifrHave = $('#iframe_div iframe[src="'+ url +'"]').length ? true : false;
                    /*判断页面存在与否*/
                    if(ifrHave){
                        $('.layadmin-tabsbody-item.layui-show').removeClass('layui-show')
                        $('#iframe_div iframe[src="'+ url +'"]').parents('.layadmin-tabsbody-item').addClass('layui-show')
                        element.tabChange('tabs', url);

                    }else{
                        bread(elem)

                        /*添加iframe*/
                        $('.layadmin-tabsbody-item.layui-show').removeClass('layui-show')
                        var ifrDiv = '<div class="layadmin-tabsbody-item layui-show">\n' +
                            '                <iframe src="'+ url +'" frameborder="0" class="layadmin-iframe"></iframe>\n' +
                            '            </div>'
                        $('#iframe_div').append(ifrDiv)

                        /*添加tab */
                        element.tabAdd('tabs', {
                            title: title,
                            id: url,
                            attr: url,
                        });
                        element.tabChange('tabs', url);
                        tbsScroll()

                    }
                }
            });

            /* 关闭当前，关闭其他，关闭全部  */
            element.on('nav(layadmin-pagetabs-nav)', function(elem){
                if(elem.parents('dd').length && ($('#tabsLi li.layui-this').attr('id') != 'firstTab')){
                    if((elem.parents('dd').attr('layadmin-event') == 'closeThisTabs')){
                        element.tabDelete('tabs', $('#tabsLi li.layui-this').attr('lay-id'));
                    }else if(elem.parents('dd').attr('layadmin-event') == 'closeOtherTabs'){
                        $('#tabsLi li').each(function(index, item){
                            if(index!=0 && $(item).attr('class')!= 'layui-this'){
                                element.tabDelete('tabs', $(item).attr('lay-id'));
                            }
                        })
                    }else if(elem.parents('dd').attr('layadmin-event') == 'closeAllTabs'){
                        $('#tabsLi li').each(function(index, item){
                            if(index!=0){
                                element.tabDelete('tabs', $(item).attr('lay-id'));
                            }
                        })
                    }
                }
            });


            /*点击tab*/
            element.on('tab(tabs)', function(data){
                breadIndex = data.index
                var ifrDivs = $('.layadmin-tabsbody-item')
                $('.layadmin-tabsbody-item.layui-show').removeClass('layui-show')
                $(ifrDivs[data.index]).addClass('layui-show')

                if(breadArr[breadIndex]){
                    $('.layui-breadcrumb>a:first-child').text(breadArr[breadIndex]['a1'])
                    $('.layui-breadcrumb>a:nth-of-type(2)').text(breadArr[breadIndex]['a2'])
                    $('.layui-breadcrumb>a:nth-of-type(3) cite').text(breadArr[breadIndex]['a3'])
                }

            });
            /*删除tab*/
            element.on('tabDelete(tabs)', function(data){
                var ifrs = $('#iframe_div iframe')
                var ifrLength = ifrs.length
                var index = data.index
                if($('#tabsLi>li')[index]!=$('#tabsLi>li.layui-this')[0]){
                    $(ifrs[index]).parents('.layadmin-tabsbody-item').remove()
                    breadArr.splice(index, 1);
                }else{
                    if(index == (ifrLength-1)){
                        $(ifrs[index]).parents('.layadmin-tabsbody-item').remove()
                        $(ifrs[index-1]).parents('.layadmin-tabsbody-item').addClass('layui-show')
                    }else{
                        breadArr.splice(index, 1);
                        $(ifrs[index]).parents('.layadmin-tabsbody-item').remove()
                        $(ifrs[index+1]).parents('.layadmin-tabsbody-item').addClass('layui-show')
                    }

                }
                tbsScroll()
            });


        });

        /* 更新面包屑的内容  */
        function bread(elem){
            var a1 = elem.parents('dl').siblings('a')[0].innerText
            var a2 = elem.parents('dl').siblings('a')[1].innerText
            var a3 = elem.text()
            $('.layui-breadcrumb>a:first-child').text(a1)
            $('.layui-breadcrumb>a:nth-of-type(2)').text(a2)
            $('.layui-breadcrumb>a:nth-of-type(3) cite').text(a3)
            setTimeout(function(){
                $('.layui-card.layadmin-header').show()
                breadArr[breadIndex] = {
                    a1: a1,
                    a2: a2,
                    a3: a3
                }
            })
        }


        function showHideNav(){
            if($(window).innerWidth()<=992){
                $('#flexible i').removeClass('layui-icon-shrink-right').addClass('layui-icon-spread-left')
                slide_div.attr('style','')
                slide_content.attr('style','')
                show = false
            }else{
                $('#flexible i').removeClass('layui-icon-spread-left').addClass('layui-icon-shrink-right')
                slide_div.attr('style','')
                slide_content.attr('style','')
                show = true
            }
        }
        showHideNav()

        $(window).resize(function () {
            showHideNav()
            tbsScroll()
        })
        /* 显示隐藏nav的图标 */
        $('#flexible i').click(function () {
            if(show){
                $(this).removeClass('layui-icon-shrink-right').addClass('layui-icon-spread-left')
                slide_div.css('transform','translate3d(-220px,0,0)')
                slide_content.css('left', '0')
                show = false
            }else{
                $(this).removeClass('layui-icon-spread-left').addClass('layui-icon-shrink-right')
                slide_div.css('transform','translate3d(0,0,0)')
                slide_content.css('left', '220px')
                show = true
            }
        })

        function tbsScroll() {
            var tab_width = 0
            var tabs_ul_Width = $('#tabsLi').width()
            $('#tabsLi li').each(function (index,item) {
                tab_width += $(item).outerWidth()
            })
            if(tabs_ul_Width < tab_width){
                var left = tabs_ul_Width - tab_width
                $('#tabsLi').css('left', left+'px')
            }else{
                $('#tabsLi').css('left', 0)
            }
        }

        /*tab 左右箭头*/
        $('.layui-icon-prev').click(function () {
            $('#tabsLi').css('left', 0)
        })
        $('.layui-icon-next').click(function () {
            tbsScroll()
        })

    })

</script>
</body>
</html> 